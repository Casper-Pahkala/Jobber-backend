import{ab as ie,r,c as M,ae as d,af as I,an as o,ah as m,ai as f,ag as l,aj as p,t,X as N,aG as ue,ak as i,a6 as re,ap as P,aB as R,P as c,aC as de,aD as ce}from"./index-c33e5e7d.js";import{_ as me,V as O,a as U}from"./_plugin-vue_export-helper-b629449e.js";import{V as q}from"./VContainer-dc1123d3.js";import{b as fe,V as u,a as pe}from"./VForm-905294af.js";import{V as G}from"./VDivider-d608bd1f.js";import{V as ve,c as ge,e as _e}from"./VCard-bafe837c.js";import"./VOverlay-ccc47a72.js";const j=b=>(de("data-v-9e5c64b5"),b=b(),ce(),b),ye={class:"main-wrapper"},ke={class:"main-content"},Ve={class:"row"},we={class:"profile-image-container"},xe={key:1,class:"profile-image empty"},he={class:"user-info"},Ce={class:"fullname"},Ie={class:"joined-at"},Ue=j(()=>o("h4",null," Nimi ",-1)),be=j(()=>o("h4",null," Sähköposti ",-1)),$e=j(()=>o("h4",null," Poista käyttäjä ",-1)),Be=j(()=>o("canvas",{id:"imageCanvas",style:{display:"none"}},null,-1)),Ne={class:"new-profile-img-wrapper"},Pe={class:"new-profile-img-container"},je={__name:"Account",setup(b){window.scrollTo(0,0);const e=ie(),W=r(null),v=r(!1),D=r(null),F=r(null),H=r(0),g=r(!1),_=r(!1),y=r(""),k=r(""),V=r(""),L=M(()=>e.user?e.user.first_name+" "+e.user.last_name:""),S=r(!0),X=[n=>!!n||"Syötä sähköposti",n=>/.+@.+\..+/.test(n)||"Syötä kelpaava sähköposti",n=>n!=e.user.email||"Syötä uusi sähköposti"],z=M(()=>e.user?"Käyttäjä luotu "+e.formatDate(e.user.created_at):"");e.user?(y.value=e.user.email,k.value=e.user.first_name,V.value=e.user.last_name):e.loginDialogShowing=!0;function J(n){const a=n.target.files[0];if(a)if(a.type.startsWith("image/")&&!a.type.startsWith("image/gif")){F.value=null,D.value=null,e.loading=!0,v.value=!0;var s=new FileReader;s.onload=function(le){const w=new Image;w.onload=()=>{let $=1080,B=1080;const x=document.getElementById("imageCanvas"),se=x.getContext("2d"),A=w.width/w.height,oe=$/B;let h,C,T,E;A>oe?(C=B,h=C*A,E=0,T=(h-$)/2):(h=$,C=h/A,T=0,E=(C-B)/2),x.width=$,x.height=B,se.drawImage(w,-T,-E,h,C),x.toBlob(ne=>{F.value=new File([ne],a.name,{type:a.type}),D.value=x.toDataURL("image/jpeg",.8),e.loading=!1},a.type,.8)},w.src=le.target.result},s.readAsDataURL(a)}else e.snackbarText="Valitse kuva tiedostotyyppi",e.snackbarColor="red-darken-2",e.snackbar=!0}function K(){W.value.click()}function Q(){let n={image:F.value};e.loading=!0,e.loadingBackground=!0,e.uploadProfileImage(n).then(a=>{v.value=!1,e.loading=!1,e.loadingBackground=!1,setTimeout(()=>{H.value++},500)}).catch(a=>{e.loading=!1,e.loadingBackground=!1})}e.tab="account";function Y(){g.value=!1,y.value=e.user.email}function Z(){_.value=!1,k.value=e.user.first_name,V.value=e.user.last_name}function ee(){window.confirm("Haluatko varmasti poistaa käyttäjäsi?")&&e.deleteUser()}function ae(){let n={email:y.value,type:"email"};e.editUser(n).then(()=>{g.value=!1,setTimeout(()=>{e.getUser()},100)})}function te(){let n={first_name:k.value,last_name:V.value,type:"name"};e.editUser(n).then(()=>{_.value=!1,setTimeout(()=>{e.getUser()},100)})}return(n,a)=>(d(),I(N,null,[o("div",ye,[o("div",ke,[m(e).user?(d(),f(q,{key:0,style:{"margin-top":"120px"}},{default:l(()=>[o("div",Ve,[o("div",we,[m(e).user.has_image?(d(),f(O,{src:`${m(e).url}/profile-image/${m(e).user.id}?${Date.now()}`,cover:"",class:"profile-image",key:H.value},{placeholder:l(()=>[t(U,{class:"fill-height ma-0",align:"center",justify:"center"},{default:l(()=>[t(ue,{indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:1},8,["src"])):p("",!0),m(e).user.has_image?p("",!0):(d(),I("div",xe,[t(re,{class:"empty-icon"},{default:l(()=>[i(" mdi-account ")]),_:1})])),o("div",{onClick:a[0]||(a[0]=s=>K()),class:"change-img-text"},"Vaihda kuva")]),o("div",he,[o("span",Ce,P(L.value),1),o("span",Ie,P(z.value),1)])])]),_:1})):p("",!0),m(e).user?(d(),f(q,{key:1,class:"profile-container"},{default:l(()=>[t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[Ue]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[_.value?(d(),I(N,{key:1},[t(U,{style:{"max-width":"440px"}},{default:l(()=>[t(u,{cols:"6"},{default:l(()=>[t(R,{variant:"outlined",style:{"max-width":"200px"},density:"compact",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=s=>k.value=s)},null,8,["modelValue"])]),_:1}),t(u,{cols:"6"},{default:l(()=>[t(R,{variant:"outlined",style:{"max-width":"200px"},density:"compact",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=s=>V.value=s)},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{variant:"outlined",class:"text-none",onClick:a[3]||(a[3]=s=>Z())},{default:l(()=>[i(" Peruuta ")]),_:1}),t(c,{variant:"outlined",class:"text-none ml-5",color:"primary",onClick:a[4]||(a[4]=s=>te())},{default:l(()=>[i(" Tallenna ")]),_:1})],64)):(d(),I(N,{key:0},[i(P(L.value),1)],64))]),_:1}),_.value?p("",!0):(d(),f(u,{key:0,cols:"3",class:"actions"},{default:l(()=>[t(c,{variant:"outlined",class:"text-none",color:"primary",onClick:a[5]||(a[5]=s=>_.value=!0)},{default:l(()=>[i(" Muokkaa ")]),_:1})]),_:1}))]),_:1}),t(G),t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[be]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[g.value?(d(),f(pe,{key:1,ref:"form",modelValue:S.value,"onUpdate:modelValue":a[9]||(a[9]=s=>S.value=s)},{default:l(()=>[t(R,{variant:"outlined",style:{"max-width":"400px"},density:"compact",modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=s=>y.value=s),rules:X,required:"",type:"email",name:"email"},null,8,["modelValue"]),t(c,{variant:"outlined",class:"text-none",onClick:a[7]||(a[7]=s=>Y())},{default:l(()=>[i(" Peruuta ")]),_:1}),t(c,{variant:"outlined",class:"text-none ml-5",color:"primary",onClick:a[8]||(a[8]=s=>ae()),disabled:!S.value},{default:l(()=>[i(" Tallenna ")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])):(d(),I(N,{key:0},[i(P(m(e).user.email),1)],64))]),_:1}),t(u,{cols:"3",class:"actions"},{default:l(()=>[g.value?p("",!0):(d(),f(c,{key:0,variant:"outlined",class:"text-none",color:"primary",onClick:a[10]||(a[10]=s=>g.value=!0)},{default:l(()=>[i(" Muokkaa ")]),_:1}))]),_:1})]),_:1}),t(G),t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[$e]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[i(" Kaikki tietosi poistetaan tietokannastamme, eikä tätä voi peruuttaa ")]),_:1}),t(u,{cols:"3",class:"actions"},{default:l(()=>[t(c,{variant:"outlined",class:"text-none",color:"error",onClick:ee},{default:l(()=>[i(" Poista käyttäjä ")]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)])]),o("input",{type:"file",ref_key:"fileInput",ref:W,onChange:J,style:{display:"none"},id:"customFileInput"},null,544),t(fe,{modelValue:v.value,"onUpdate:modelValue":a[14]||(a[14]=s=>v.value=s),width:"500"},{default:l(()=>[t(ve,null,{default:l(()=>[Be,t(ge,null,{default:l(()=>[o("div",Ne,[o("div",Pe,[t(O,{src:D.value,alt:"your image",cover:"","aspect-ratio":"1",id:"new-profile-img"},null,8,["src"])]),o("div",{onClick:a[11]||(a[11]=s=>K()),class:"change-img-text"},"Vaihda kuva")])]),_:1}),t(_e,null,{default:l(()=>[t(u,{class:"d-flex justify-space-between"},{default:l(()=>[t(c,{onClick:a[12]||(a[12]=s=>v.value=!1),class:"text-none"},{default:l(()=>[i("Peruuta")]),_:1}),t(c,{color:"primary",onClick:a[13]||(a[13]=s=>Q()),class:"text-none"},{default:l(()=>[i("Valmis")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},We=me(je,[["__scopeId","data-v-9e5c64b5"]]);export{We as default};
