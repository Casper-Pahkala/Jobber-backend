import{ab as ie,r,c as K,ae as d,af as I,al as o,ah as m,ai as f,ag as l,aj as p,t,X as b,aG as ue,ak as i,a6 as re,am as j,aD as E,P as c,ap as de,aq as ce}from"./index-3b31550a.js";import{_ as me,V as M,a as U}from"./_plugin-vue_export-helper-b6f1a44b.js";import{V as O}from"./VContainer-5ad096d1.js";import{b as fe,V as u,a as pe}from"./VForm-e3cdf166.js";import{V as G}from"./VDivider-5b77f61a.js";import{V as ve,d as ge,e as _e}from"./VCard-28e5a739.js";import"./VOverlay-ccc98421.js";const B=P=>(de("data-v-fd2e3421"),P=P(),ce(),P),ye={class:"main-wrapper"},ke={class:"main-content"},Ve={class:"row"},we={class:"profile-image-container"},he={key:1,class:"profile-image empty"},xe={class:"user-info"},Ce={class:"fullname"},Ie={class:"joined-at"},Ue=B(()=>o("h4",null," Nimi ",-1)),Pe=B(()=>o("h4",null," Sähköposti ",-1)),Ne=B(()=>o("h4",null," Poista käyttäjä ",-1)),Se=B(()=>o("canvas",{id:"imageCanvas",style:{display:"none"}},null,-1)),be={class:"new-profile-img-wrapper"},je={class:"new-profile-img-container"},Be={__name:"Account",setup(P){window.scrollTo(0,0);const e=ie(),L=r(null),v=r(!1),D=r(null),F=r(null),W=r(0),g=r(!1),_=r(!1),y=r(""),k=r(""),V=r(""),H=K(()=>e.user?e.user.first_name+" "+e.user.last_name:""),$=r(!0),X=[n=>!!n||"Syötä sähköposti",n=>/.+@.+\..+/.test(n)||"Syötä kelpaava sähköposti",n=>n!=e.user.email||"Syötä uusi sähköposti"],z=K(()=>e.user?"Käyttäjä luotu "+e.formatDate(e.user.created_at):"");e.user?(y.value=e.user.email,k.value=e.user.first_name,V.value=e.user.last_name):e.loginDialogShowing=!0;function J(n){const a=n.target.files[0];if(a)if(a.type.startsWith("image/")&&!a.type.startsWith("image/gif")){F.value=null,D.value=null,e.loading=!0,v.value=!0;var s=new FileReader;s.onload=function(le){const w=new Image;w.onload=()=>{let N=1080,S=1080;const h=document.getElementById("imageCanvas"),se=h.getContext("2d"),A=w.width/w.height,oe=N/S;let x,C,R,T;A>oe?(C=S,x=C*A,T=0,R=(x-N)/2):(x=N,C=x/A,R=0,T=(C-S)/2),h.width=N,h.height=S,se.drawImage(w,-R,-T,x,C),h.toBlob(ne=>{F.value=new File([ne],a.name,{type:a.type}),D.value=h.toDataURL("image/jpeg",.8),e.loading=!1},a.type,.8)},w.src=le.target.result},s.readAsDataURL(a)}else e.snackbarText="Valitse kuva tiedostotyyppi",e.snackbarColor="red-darken-2",e.snackbar=!0}function q(){L.value.click()}function Q(){let n={image:F.value};e.loading=!0,e.loadingBackground=!0,e.uploadProfileImage(n).then(a=>{v.value=!1,e.loading=!1,e.loadingBackground=!1;let s=new URL(e.user.profileImageUrl);s.searchParams.set("t",new Date),e.user.profileImageUrl=s.toString(),setTimeout(()=>{W.value++},500)}).catch(a=>{e.loading=!1,e.loadingBackground=!1})}e.tab="account";function Y(){g.value=!1,y.value=e.user.email}function Z(){_.value=!1,k.value=e.user.first_name,V.value=e.user.last_name}function ee(){window.confirm("Haluatko varmasti poistaa käyttäjäsi?")&&e.deleteUser()}function ae(){let n={email:y.value,type:"email"};e.editUser(n).then(()=>{g.value=!1,setTimeout(()=>{e.getUser()},100)})}function te(){let n={first_name:k.value,last_name:V.value,type:"name"};e.editUser(n).then(()=>{_.value=!1,setTimeout(()=>{e.getUser()},100)})}return(n,a)=>(d(),I(b,null,[o("div",ye,[o("div",ke,[m(e).user?(d(),f(O,{key:0,style:{"margin-top":"120px"}},{default:l(()=>[o("div",Ve,[o("div",we,[m(e).user.has_image?(d(),f(M,{src:m(e).user.profileImageUrl,cover:"",class:"profile-image",key:W.value},{placeholder:l(()=>[t(U,{class:"fill-height ma-0",align:"center",justify:"center"},{default:l(()=>[t(ue,{indeterminate:"",color:"grey-lighten-5"})]),_:1})]),_:1},8,["src"])):p("",!0),m(e).user.has_image?p("",!0):(d(),I("div",he,[t(re,{class:"empty-icon"},{default:l(()=>[i(" mdi-account ")]),_:1})])),o("div",{onClick:a[0]||(a[0]=s=>q()),class:"change-img-text"},"Vaihda kuva")]),o("div",xe,[o("span",Ce,j(H.value),1),o("span",Ie,j(z.value),1)])])]),_:1})):p("",!0),m(e).user?(d(),f(O,{key:1,class:"profile-container"},{default:l(()=>[t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[Ue]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[_.value?(d(),I(b,{key:1},[t(U,{style:{"max-width":"440px"}},{default:l(()=>[t(u,{cols:"6"},{default:l(()=>[t(E,{variant:"outlined",style:{"max-width":"200px"},density:"compact",modelValue:k.value,"onUpdate:modelValue":a[1]||(a[1]=s=>k.value=s)},null,8,["modelValue"])]),_:1}),t(u,{cols:"6"},{default:l(()=>[t(E,{variant:"outlined",style:{"max-width":"200px"},density:"compact",modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=s=>V.value=s)},null,8,["modelValue"])]),_:1})]),_:1}),t(c,{variant:"outlined",class:"text-none",onClick:a[3]||(a[3]=s=>Z())},{default:l(()=>[i(" Peruuta ")]),_:1}),t(c,{variant:"outlined",class:"text-none ml-5",color:"primary",onClick:a[4]||(a[4]=s=>te())},{default:l(()=>[i(" Tallenna ")]),_:1})],64)):(d(),I(b,{key:0},[i(j(H.value),1)],64))]),_:1}),_.value?p("",!0):(d(),f(u,{key:0,cols:"3",class:"actions"},{default:l(()=>[t(c,{variant:"outlined",class:"text-none",color:"primary",onClick:a[5]||(a[5]=s=>_.value=!0)},{default:l(()=>[i(" Muokkaa ")]),_:1})]),_:1}))]),_:1}),t(G),t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[Pe]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[g.value?(d(),f(pe,{key:1,ref:"form",modelValue:$.value,"onUpdate:modelValue":a[9]||(a[9]=s=>$.value=s)},{default:l(()=>[t(E,{variant:"outlined",style:{"max-width":"400px"},density:"compact",modelValue:y.value,"onUpdate:modelValue":a[6]||(a[6]=s=>y.value=s),rules:X,required:"",type:"email",name:"email"},null,8,["modelValue"]),t(c,{variant:"outlined",class:"text-none",onClick:a[7]||(a[7]=s=>Y())},{default:l(()=>[i(" Peruuta ")]),_:1}),t(c,{variant:"outlined",class:"text-none ml-5",color:"primary",onClick:a[8]||(a[8]=s=>ae()),disabled:!$.value},{default:l(()=>[i(" Tallenna ")]),_:1},8,["disabled"])]),_:1},8,["modelValue"])):(d(),I(b,{key:0},[i(j(m(e).user.email),1)],64))]),_:1}),t(u,{cols:"3",class:"actions"},{default:l(()=>[g.value?p("",!0):(d(),f(c,{key:0,variant:"outlined",class:"text-none",color:"primary",onClick:a[10]||(a[10]=s=>g.value=!0)},{default:l(()=>[i(" Muokkaa ")]),_:1}))]),_:1})]),_:1}),t(G),t(U,{class:"info-wrapper"},{default:l(()=>[t(u,{cols:"3",class:"title"},{default:l(()=>[Ne]),_:1}),t(u,{cols:"6",class:"content"},{default:l(()=>[i(" Kaikki tietosi poistetaan tietokannastamme, eikä tätä voi peruuttaa ")]),_:1}),t(u,{cols:"3",class:"actions"},{default:l(()=>[t(c,{variant:"outlined",class:"text-none",color:"error",onClick:ee},{default:l(()=>[i(" Poista käyttäjä ")]),_:1})]),_:1})]),_:1})]),_:1})):p("",!0)])]),o("input",{type:"file",ref_key:"fileInput",ref:L,onChange:J,style:{display:"none"},id:"customFileInput"},null,544),t(fe,{modelValue:v.value,"onUpdate:modelValue":a[14]||(a[14]=s=>v.value=s),width:"500"},{default:l(()=>[t(ve,null,{default:l(()=>[Se,t(ge,null,{default:l(()=>[o("div",be,[o("div",je,[t(M,{src:D.value,alt:"your image",cover:"","aspect-ratio":"1",id:"new-profile-img"},null,8,["src"])]),o("div",{onClick:a[11]||(a[11]=s=>q()),class:"change-img-text"},"Vaihda kuva")])]),_:1}),t(_e,null,{default:l(()=>[t(u,{class:"d-flex justify-space-between"},{default:l(()=>[t(c,{onClick:a[12]||(a[12]=s=>v.value=!1),class:"text-none"},{default:l(()=>[i("Peruuta")]),_:1}),t(c,{color:"primary",onClick:a[13]||(a[13]=s=>Q()),class:"text-none"},{default:l(()=>[i("Valmis")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},Le=me(Be,[["__scopeId","data-v-fd2e3421"]]);export{Le as default};
